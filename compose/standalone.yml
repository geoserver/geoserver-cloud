# Standalone mode configuration for GeoServer Cloud
# - Disables infrastructure services (discovery, config)
# - Applies standalone profile to all GeoServer services
# - Works with various catalog backends (datadir, pgconfig)

# Override x-gs-dependencies from compose.yml to exclude discovery service
x-gs-standalone-dependencies: &gs-standalone-dependencies
  rabbitmq:
    condition: service_healthy
    required: true
  acl:
    condition: service_healthy
    required: true
  geodatabase:
    condition: service_started
    required: true
  init-test-data:
    condition: service_completed_successfully
    required: true

services:
  # Disable infrastructure services in standalone mode
  discovery:
    deploy:
      replicas: 0

  config:
    deploy:
      replicas: 0

  # Apply standalone profile to all services
  gateway:
    environment:
      SPRING_PROFILES_INCLUDE: "standalone"
    depends_on: {}

  wfs:
    environment:
      SPRING_PROFILES_INCLUDE: "standalone"
    depends_on: *gs-standalone-dependencies

  wms:
    environment:
      SPRING_PROFILES_INCLUDE: "standalone"
    depends_on: *gs-standalone-dependencies

  wcs:
    environment:
      SPRING_PROFILES_INCLUDE: "standalone"
    depends_on: *gs-standalone-dependencies

  wps:
    environment:
      SPRING_PROFILES_INCLUDE: "standalone"
    depends_on: *gs-standalone-dependencies

  restconfig:
    environment:
      SPRING_PROFILES_INCLUDE: "standalone"
    depends_on: *gs-standalone-dependencies

  webui:
    environment:
      SPRING_PROFILES_INCLUDE: "standalone"
    depends_on: *gs-standalone-dependencies

  gwc:
    environment:
      SPRING_PROFILES_INCLUDE: "standalone"
    depends_on: *gs-standalone-dependencies
